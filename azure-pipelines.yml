# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
- master

jobs:
- deployment: VMDeploy
  displayName: kafka_containers
  environment:
    name: vm2v8g
    resourceType: VirtualMachine
  strategy:
      runOnce:
        deploy:
          steps:
          - download: current
            artifact: docker-compose
            patterns: 'https://greencoin2020@dev.azure.com/greencoin2020/Greencoin_project/_git/Greencoin_project/docker-compose.yml'
          - task: DockerInstaller@0
            inputs:
              dockerVersion: '17.09.0-ce'
          - task: DockerCompose@0
            inputs:
              containerregistrytype: 'Azure Container Registry'
              azureSubscription: 'Azure subscription 1(783128f5-f4d2-4f2c-bfe4-1d2af23c8de0)'
              azureContainerRegistry: '{"loginServer":"dockaf.azurecr.io", "id" : "/subscriptions/783128f5-f4d2-4f2c-bfe4-1d2af23c8de0/resourceGroups/vm-kafka3_group/providers/Microsoft.ContainerRegistry/registries/dockaf"}'
              dockerComposeFile: '**/docker-compose.yml'
              action: 'run services'
